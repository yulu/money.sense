{{ define "main" }}
{{ $myData := (index site.Data site.Language.Lang) }}

<!-- Header -->
{{ partial "header" }}

<!-- Category Tabs Navigation -->
<div class="category-tabs">
    <div class="container container-wide">
        <div class="category-tabs-inner">
            <a href="#money-philosophy" class="category-tab">{{ i18n "MoneyPhilosophy" }}</a>
            <a href="#insurance" class="category-tab">{{ i18n "Insurance" }}</a>
            <a href="#saving-investment" class="category-tab">{{ i18n "SavingAndInvestment" }}</a>
            <a href="#properties" class="category-tab">{{ i18n "Properties" }}</a>
            <a href="#estate-planning" class="category-tab">{{ i18n "EstatePlanning" }}</a>
        </div>
    </div>
</div>

<!-- Post List Sections -->
<section class="post-list-section">
    <div class="container container-wide">
        
        <!-- MoneyPhilosophy -->
        <div id="money-philosophy" class="post-list-category">
            <h2 class="post-list-category-title">{{ i18n "MoneyPhilosophy" }}</h2>
            <ul class="post-list">
                {{ $p := where .Pages ".Params.tags" "intersect" (slice "MoneyPhilosophy") }}
                {{ range $p }}
                {{ $img := "" }}
                {{ with findRE "<img[^>]+src=\"([^\"]+)\"" .Content 1 }}
                    {{ $img = index (findRE "src=\"([^\"]+)\"" (index . 0) 1) 0 | replaceRE "src=\"(.+)\"" "$1" }}
                {{ end }}
                <li class="post-list-item" {{ if $img }}style="background-image: url('{{ $img }}');"{{ end }}>
                    <a href="{{ .Permalink }}" class="post-list-item-link">
                        <div class="post-list-item-overlay"></div>
                        <div class="post-list-item-content">
                        <h3 class="post-list-item-title">
                            {{ .Title }}
                        </h3>
                        <div class="post-list-item-meta">
                            {{ .Date.Format "January 2, 2006" }}
                        </div>
                        {{ with .Params.addtags }}
                        <div class="post-list-item-tags">
                            {{ range . }}
                            <span class="post-tag">{{ . }}</span>
                            {{ end }}
                        </div>
                        {{ end }}
                        {{ with .Description }}
                        <p class="post-list-item-description">{{ . }}</p>
                        {{ end }}
                        </div>
                    </a>
                </li>
                {{ end }}
            </ul>
        </div>

        <!-- Insurance -->
        <div id="insurance" class="post-list-category">
            <h2 class="post-list-category-title">{{ i18n "Insurance" }}</h2>
            <ul class="post-list">
                {{ $p := where .Pages ".Params.tags" "intersect" (slice "Insurance") }}
                {{ range $p }}
                {{ $img := "" }}
                {{ with findRE "<img[^>]+src=\"([^\"]+)\"" .Content 1 }}
                    {{ $img = index (findRE "src=\"([^\"]+)\"" (index . 0) 1) 0 | replaceRE "src=\"(.+)\"" "$1" }}
                {{ end }}
                <li class="post-list-item" {{ if $img }}style="background-image: url('{{ $img }}');"{{ end }}>
                    <a href="{{ .Permalink }}" class="post-list-item-link">
                        <div class="post-list-item-overlay"></div>
                        <div class="post-list-item-content">
                        <h3 class="post-list-item-title">
                            {{ .Title }}
                        </h3>
                        <div class="post-list-item-meta">
                            {{ .Date.Format "January 2, 2006" }}
                        </div>
                        {{ with .Params.addtags }}
                        <div class="post-list-item-tags">
                            {{ range . }}
                            <span class="post-tag">{{ . }}</span>
                            {{ end }}
                        </div>
                        {{ end }}
                        {{ with .Description }}
                        <p class="post-list-item-description">{{ . }}</p>
                        {{ end }}
                        </div>
                    </a>
                </li>
                {{ end }}
            </ul>
        </div>

        <!-- SavingAndInvestment -->
        <div id="saving-investment" class="post-list-category">
            <h2 class="post-list-category-title">{{ i18n "SavingAndInvestment" }}</h2>
            <ul class="post-list">
                {{ $p := where .Pages ".Params.tags" "intersect" (slice "SavingAndInvestment") }}
                {{ range $p }}
                {{ $img := "" }}
                {{ with findRE "<img[^>]+src=\"([^\"]+)\"" .Content 1 }}
                    {{ $img = index (findRE "src=\"([^\"]+)\"" (index . 0) 1) 0 | replaceRE "src=\"(.+)\"" "$1" }}
                {{ end }}
                <li class="post-list-item" {{ if $img }}style="background-image: url('{{ $img }}');"{{ end }}>
                    <a href="{{ .Permalink }}" class="post-list-item-link">
                        <div class="post-list-item-overlay"></div>
                        <div class="post-list-item-content">
                        <h3 class="post-list-item-title">
                            {{ .Title }}
                        </h3>
                        <div class="post-list-item-meta">
                            {{ .Date.Format "January 2, 2006" }}
                        </div>
                        {{ with .Params.addtags }}
                        <div class="post-list-item-tags">
                            {{ range . }}
                            <span class="post-tag">{{ . }}</span>
                            {{ end }}
                        </div>
                        {{ end }}
                        {{ with .Description }}
                        <p class="post-list-item-description">{{ . }}</p>
                        {{ end }}
                        </div>
                    </a>
                </li>
                {{ end }}
            </ul>
        </div>

        <!-- Properties -->
        <div id="properties" class="post-list-category">
            <h2 class="post-list-category-title">{{ i18n "Properties" }}</h2>
            <ul class="post-list">
                {{ $p := where .Pages ".Params.tags" "intersect" (slice "Properties") }}
                {{ range $p }}
                {{ $img := "" }}
                {{ with findRE "<img[^>]+src=\"([^\"]+)\"" .Content 1 }}
                    {{ $img = index (findRE "src=\"([^\"]+)\"" (index . 0) 1) 0 | replaceRE "src=\"(.+)\"" "$1" }}
                {{ end }}
                <li class="post-list-item" {{ if $img }}style="background-image: url('{{ $img }}');"{{ end }}>
                    <a href="{{ .Permalink }}" class="post-list-item-link">
                        <div class="post-list-item-overlay"></div>
                        <div class="post-list-item-content">
                        <h3 class="post-list-item-title">
                            {{ .Title }}
                        </h3>
                        <div class="post-list-item-meta">
                            {{ .Date.Format "January 2, 2006" }}
                        </div>
                        {{ with .Params.addtags }}
                        <div class="post-list-item-tags">
                            {{ range . }}
                            <span class="post-tag">{{ . }}</span>
                            {{ end }}
                        </div>
                        {{ end }}
                        {{ with .Description }}
                        <p class="post-list-item-description">{{ . }}</p>
                        {{ end }}
                        </div>
                    </a>
                </li>
                {{ end }}
            </ul>
        </div>

        <!-- EstatePlanning -->
        <div id="estate-planning" class="post-list-category">
            <h2 class="post-list-category-title">{{ i18n "EstatePlanning" }}</h2>
            <ul class="post-list">
                {{ $p := where .Pages ".Params.tags" "intersect" (slice "EstatePlanning") }}
                {{ range $p }}
                {{ $img := "" }}
                {{ with findRE "<img[^>]+src=\"([^\"]+)\"" .Content 1 }}
                    {{ $img = index (findRE "src=\"([^\"]+)\"" (index . 0) 1) 0 | replaceRE "src=\"(.+)\"" "$1" }}
                {{ end }}
                <li class="post-list-item" {{ if $img }}style="background-image: url('{{ $img }}');"{{ end }}>
                    <a href="{{ .Permalink }}" class="post-list-item-link">
                        <div class="post-list-item-overlay"></div>
                        <div class="post-list-item-content">
                        <h3 class="post-list-item-title">
                            {{ .Title }}
                        </h3>
                        <div class="post-list-item-meta">
                            {{ .Date.Format "January 2, 2006" }}
                        </div>
                        {{ with .Params.addtags }}
                        <div class="post-list-item-tags">
                            {{ range . }}
                            <span class="post-tag">{{ . }}</span>
                            {{ end }}
                        </div>
                        {{ end }}
                        {{ with .Description }}
                        <p class="post-list-item-description">{{ . }}</p>
                        {{ end }}
                        </div>
                    </a>
                </li>
                {{ end }}
            </ul>
        </div>

    </div>
</section>

<!-- Archive Link -->
<section class="archive-link-section">
    <div class="container container-wide">
        <div class="archive-link-wrapper">
            <a href="{{ "/archive" | relLangURL }}" class="archive-link-subtle">
                <i class="fas fa-archive"></i> {{ i18n "ViewAllPosts" }}
            </a>
        </div>
    </div>
</section>

<script>
// Smooth scroll and active tab highlighting
(function() {
    const tabs = document.querySelectorAll('.category-tab');
    const sections = document.querySelectorAll('.post-list-category');

    // Smooth scroll on tab click
    tabs.forEach(tab => {
        tab.addEventListener('click', function(e) {
            e.preventDefault();
            const targetId = this.getAttribute('href').substring(1);
            const targetSection = document.getElementById(targetId);
            if (targetSection) {
                const offset = 130; // Header + tabs height
                const targetPosition = targetSection.offsetTop - offset;
                window.scrollTo({
                    top: targetPosition,
                    behavior: 'smooth'
                });
            }
        });
    });

    // Highlight active tab on scroll
    function highlightActiveTab() {
        const scrollPos = window.scrollY + 150;

        sections.forEach((section, index) => {
            const sectionTop = section.offsetTop;
            const sectionBottom = sectionTop + section.offsetHeight;

            if (scrollPos >= sectionTop && scrollPos < sectionBottom) {
                tabs.forEach(t => t.classList.remove('active'));
                tabs[index].classList.add('active');
            }
        });
    }

    window.addEventListener('scroll', highlightActiveTab);
    highlightActiveTab(); // Initial highlight
})();
</script>

<!-- Footer -->
{{ partial "footer" }}

{{ end }}