{{ define "main" }}
{{ $myData := (index site.Data site.Language.Lang) }}

<!-- Header -->
{{ partial "header" }}

<!-- Breadcrumb -->
<div class="container container-narrow">
    {{ partial "breadcrumb" . }}
</div>

<!-- Post Header -->
<section class="post-header">
    <div class="container container-narrow">
        <h1 class="post-title">{{ .Title }}</h1>

        <div class="post-meta">
            {{ .Date.Format "January 2, 2006" }}
            <span class="meta-separator">â€¢</span>
            {{ $readTime := div (countwords .Content) 200 }}
            {{ if lt $readTime 1 }}{{ $readTime = 1 }}{{ end }}
            {{ $readTime }} {{ i18n "MinRead" }}
        </div>

        <div class="post-tags">
            {{ range .Params.tags }}
            <span class="tag">{{ i18n . }}</span>
            {{ end }}

            {{ with .Param "addtags" }}
            {{ range $index, $tag := (. | sort) }}
            <span class="tag">{{ $tag }}</span>
            {{ end }}
            {{ end }}
        </div>
    </div>
</section>

<!-- Post Content -->
<article class="section-sm">
    <div class="container">
        <div class="post-layout">
            <div class="post-content-wrapper">
                <div class="post-content">
                    {{ .Content }}
                </div>
                
                <!-- Disclaimer -->
                {{ partial "disclaimer" $myData.disclaimer }}

                <!-- Buy Me a Coffee -->
                {{ partial "buy_me_a_coffee" }}

                <!-- Random Posts -->
                <div class="random-posts">
                    <h3 class="random-posts-title">{{ i18n "ReadMore" }}</h3>
                    <div class="random-posts-grid">
                        {{ $currentPage := . }}
                        {{ $pages := where site.RegularPages "Section" "posts" }}
                        {{ $pages := where $pages ".Params.draft" "ne" true }}
                        {{ $pages := $pages | complement (slice $currentPage) }}
                        {{ $randomPages := shuffle $pages | first 2 }}
                        {{ range $randomPages }}
                        {{ $img := "" }}
                        {{ with findRE "<img[^>]+src=\"([^\"]+)\"" .Content 1 }}
                            {{ $img = index (findRE "src=\"([^\"]+)\"" (index . 0) 1) 0 | replaceRE "src=\"(.+)\"" "$1" }}
                        {{ end }}
                        <a href="{{ .Permalink }}" class="random-post-card" {{ if $img }}style="background-image: url('{{ $img }}');"{{ end }}>
                            <div class="random-post-overlay"></div>
                            <div class="random-post-content">
                                <h4 class="random-post-title">{{ .Title }}</h4>
                                {{ with .Description }}
                                <p class="random-post-description">{{ . }}</p>
                                {{ end }}
                                <div class="random-post-meta">
                                    {{ .Date.Format "January 2, 2006" }}
                                </div>
                            </div>
                        </a>
                        {{ end }}
                    </div>
                </div>

                <!-- Topics Section -->
                {{ partial "post_topics" }}
                
                <!-- Comments -->
                {{ template "_internal/disqus.html" . }}
            </div>
        </div>
    </div>
</article>

<!-- Footer -->
{{ partial "footer" }}

{{ end }}